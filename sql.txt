CREATE TABLE users
(
    id UUID PRIMARY KEY,
    name VARCHAR(255),
    email VARCHAR(255) UNIQUE,
    password VARCHAR(255)
);

CREATE TYPE biological_sex AS ENUM (
    'male',
    'female'
);

CREATE TYPE training_type AS ENUM (
    'strength',
    'cardio',
    'sports',
    'mixed'
);

CREATE TYPE training_intensity AS ENUM (
    'low',
    'moderate',
    'high'
);

CREATE TYPE daily_activity_level AS ENUM (
    'sedentary',
    'light',
    'moderate',
    'active',
    'very_active'
);

CREATE TYPE user_goal AS ENUM (
    'maintain',
    'gain_muscle',
    'lose_fat',
    'performance'
);


CREATE TABLE user_data (
    id UUID PRIMARY KEY,

    user_id UUID NOT NULL,
    CONSTRAINT fk_user
        FOREIGN KEY (user_id)
        REFERENCES users(id)
        ON DELETE CASCADE,

    weight_kg NUMERIC(5,2) NOT NULL,
    height_cm NUMERIC(5,2) NOT NULL,
    age INT NOT NULL,
    biological_sex biological_sex NOT NULL,

    workouts_per_week INT NOT NULL,
    training_type training_type NOT NULL,
    training_intensity training_intensity NOT NULL,
    daily_activity_level daily_activity_level NOT NULL,
    workout_details varchar(500),
    daily_activity_details varchar(500),

    user_goal user_goal NOT NULL,

    sleep_quality INT CHECK (sleep_quality BETWEEN 1 AND 5),
    stress_level INT CHECK (stress_level BETWEEN 1 AND 5),
    routine_consistency INT CHECK (routine_consistency BETWEEN 1 AND 5),

    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP
);

CREATE TABLE user_data_insights (
    id UUID PRIMARY KEY,

    user_id UUID NOT NULL,
    CONSTRAINT fk_user_data
        FOREIGN KEY (user_id)
        REFERENCES users(id)
        ON DELETE CASCADE,

    target_calories        NUMERIC(8,2),
    protein_target_g       NUMERIC(8,2), 
    carbs_target_g         NUMERIC(8,2), 
    fat_target_g           NUMERIC(8,2), 

    sleep_hours_target     NUMERIC(4,2),

    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP
);

CREATE TABLE user_meals (
    id UUID PRIMARY KEY,

    user_id UUID NOT NULL,
    CONSTRAINT fk_user_meals_user
        FOREIGN KEY (user_id)
        REFERENCES users(id)
        ON DELETE CASCADE,
        
    meal_date DATE NOT NULL,          
    meal_name VARCHAR(255),  
    meal_description VARCHAR(2000),          
    meal_time TIME,                   

    calories NUMERIC(7,2) NOT NULL,
    protein_g NUMERIC(6,2) NOT NULL,
    carbs_g NUMERIC(6,2) NOT NULL,
    fat_g NUMERIC(6,2) NOT NULL,

    explanation VARCHAR(800),

    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP
);

CREATE TABLE user_body_metrics (
    id UUID PRIMARY KEY,

    user_id UUID NOT NULL,
    metric_date DATE NOT NULL,

    weight_kg NUMERIC(5,2) NOT NULL,
    body_fat_percent NUMERIC(5,2),
    muscle_mass_kg NUMERIC(5,2),

    waist_cm NUMERIC(5,2),
    chest_cm NUMERIC(5,2),

    note VARCHAR(500),

    created_at TIMESTAMP DEFAULT NOW(),

    CONSTRAINT fk_user_body_metrics
        FOREIGN KEY (user_id)
        REFERENCES users(id)
        ON DELETE CASCADE

);
